<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ëŒ€í•œë¯¼êµ­ í†µí•© ê²Œì‹œíŒ v3</title>
<style>
body {
  background:#111; color:white; font-family:Arial,sans-serif;
  text-align:center; margin:0; padding:20px;
}
.container { max-width:900px; margin:auto; }

/* ===== ê³µì§€ ===== */
.notice {
  font-size:20px; margin-bottom:15px;
  animation:neonGlow 2s infinite alternate;
}
@keyframes neonGlow {
  0%{color:#00ffff;text-shadow:0 0 8px #00ffff;}
  50%{color:#ff00ff;text-shadow:0 0 8px #ff00ff;}
  100%{color:#ffff00;text-shadow:0 0 8px #ffff00;}
}

/* ===== ê²Œì‹œíŒ ===== */
#messages {
  border:1px solid #444; border-radius:10px;
  background:#1a1a1a; padding:10px;
  height:450px; overflow-y:auto; text-align:left;
}
table {width:100%; border-collapse:collapse;}
th,td {padding:6px; border-bottom:1px solid #333;}
th{background:#222;}
td.time{width:10%;color:#aaa;font-size:13px;}
td.channel{width:15%;color:#66ccff;text-align:center;}
td.nickname{width:10%;color:#0ff;text-align:center;}
td.content{width:65%;word-break:break-word;}
@media(max-width:600px){
  td.time{display:none;}td.channel{width:20%;}
  td.content{width:80%;font-size:15px;}
}

input,select{
  padding:6px;margin:4px;border:none;border-radius:5px;
}
button{
  padding:6px 12px;border:none;border-radius:5px;
  background:#00bfff;color:white;cursor:pointer;
}
button:hover{background:#0080ff;}
.footer{margin-top:10px;font-size:12px;color:#888;}
.pagination button{margin:3px;padding:5px 10px;}
</style>
</head>
<body>
<div class="container">
  <div class="notice">ğŸŒ ëŒ€í•œë¯¼êµ­(í†µí•©) ê¸´ê¸‰ ì»¤ë®¤ë‹ˆí‹° ì±„ë„ v3</div>

  <div id="messages">
    <table><thead><tr><th>ì‹œê°„</th><th>ì±„ë„</th><th>ë‹‰ë„¤ì„</th><th>ë‚´ìš©</th></tr></thead>
    <tbody id="messageBody"></tbody></table>
  </div>

  <div style="margin-top:10px;">
    <select id="channelSelect"></select>
    <input id="privateChannel" type="text" placeholder="ì‚¬ì„¤ ì±„ë„ëª… (ì„ íƒ)">
    <input id="nickname" type="text" maxlength="4" placeholder="ë‹‰ë„¤ì„(4ì)">
    <input id="messageInput" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
    <button onclick="sendMessage()">ì „ì†¡</button>
  </div>

  <div class="pagination" id="pagination"></div>
  <div class="footer">ì œì‘ì: luckyyyj77@gmail.com</div>
</div>

<script>
const msgBody=document.getElementById("messageBody");
const pagination=document.getElementById("pagination");
const channelSelect=document.getElementById("channelSelect");
const privateInput=document.getElementById("privateChannel");
const nicknameInput=document.getElementById("nickname");
const input=document.getElementById("messageInput");

let lastPost=0;
const POST_LIMIT=10000; // 10ì´ˆ ì œí•œ
let currentPage=1,totalPages=1;

/* ===== ì±„ë„ ëª©ë¡ ===== */
const provinces=["ì„œìš¸","ë¶€ì‚°","ëŒ€êµ¬","ì¸ì²œ","ê´‘ì£¼","ëŒ€ì „","ìš¸ì‚°","ì„¸ì¢…","ê²½ê¸°","ê°•ì›","ì¶©ë¶","ì¶©ë‚¨","ì „ë¶","ì „ë‚¨","ê²½ë¶","ê²½ë‚¨","ì œì£¼"];
channelSelect.innerHTML=`<option>ëŒ€í•œë¯¼êµ­(í†µí•©)</option>`;
provinces.forEach(p=>{
  for(let i=1;i<=9;i++){
    const opt=document.createElement("option");
    opt.textContent=`${p}${i}`;
    channelSelect.appendChild(opt);
  }
});

/* ===== ì‹œê°„(KST) ===== */
function getKST(){
  const now=new Date();
  const utc=now.getTime()+now.getTimezoneOffset()*60000;
  return new Date(utc+9*3600000).toLocaleTimeString('ko-KR',{hour12:false});
}

/* ===== ë©”ì‹œì§€ ë¶ˆëŸ¬ì˜¤ê¸° ===== */
async function loadMessages(page=1){
  const res=await fetch(`/api/messages?page=${page}`);
  const data=await res.json();
  msgBody.innerHTML="";
  data.data.forEach(addMessage);
  currentPage=data.page; totalPages=data.pages;
  renderPagination();
}

/* ===== ë©”ì‹œì§€ ì¶œë ¥ ===== */
function addMessage(m){
  const tr=document.createElement("tr");
  tr.innerHTML=`<td class="time">${m.time}</td><td class="channel">${m.channel}</td><td class="nickname">${m.nickname||"ìµëª…"}</td><td class="content">${m.text}</td>`;
  msgBody.appendChild(tr);
}

/* ===== í˜ì´ì§€ë„¤ì´ì…˜ ===== */
function renderPagination(){
  pagination.innerHTML="";
  for(let i=1;i<=totalPages;i++){
    const btn=document.createElement("button");
    btn.textContent=i;
    if(i===currentPage) btn.style.background="#444";
    btn.onclick=()=>loadMessages(i);
    pagination.appendChild(btn);
  }
}

/* ===== ë©”ì‹œì§€ ì „ì†¡ ===== */
async function sendMessage(){
  const now=Date.now();
  if(now-lastPost<POST_LIMIT){alert("âš ï¸ ë„ˆë¬´ ë¹ ë¦…ë‹ˆë‹¤. 10ì´ˆ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");return;}
  const text=input.value.trim(); if(!text) return;
  const channel=privateInput.value.trim()||channelSelect.value;
  const nickname=nicknameInput.value.trim()||"ìµëª…";
  const msg={time:getKST(),channel,nickname,text};
  await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(msg)});
  input.value=""; lastPost=now; loadMessages(1);
}

/* ===== ìë™ ë¡œë“œ ===== */
loadMessages();
setInterval(()=>loadMessages(currentPage),7000);
</script>
</body>
</html>
